## Яндекс Практикум, курс "Инженер Машинного Обучения" (2024 г.)
## Проект 2-го спринта: "Улучшение baseline-модели"
### *Выполнил: Кирилл Н., email: ibnkir@yandex.ru, бакет в S3: s3-student-mle-20240227-804436ded9*

### Краткое описание
Целью проекта является практическое освоение MLflow для мониторинга процесса обучения и логирования параметров, метрик, моделей и других артефактов, а также использование различных инструментов для улучшения моделей, включая генерацию и отбор признаков, подбор гипер-параметров. В качестве бейзлайна используется модель предсказания цен на квартиры из проекта 1-го спринта.

Основные инструменты: sklearn, catboost, MLflow, Autofeat, mlxtend, Optuna 

### Установка
В терминале перейти в папку, которая будет содержать папку проекта, и выполнить следующую последовательность команд:

git clone https://github.com/ibnkir/mle-project-sprint-2

cd ./mle-project-sprint-2

pip install -r requirements.txt

### Руководство по проекту
#### Этап 1: Развертывание MLflow и регистрация модели
Были загружены очищенные данные из проекта 1-го спринта, обучена модель и проведена кросс-валидация. Полученные метрики и модель были залогированы в MLflow.

Шаги:
- Развернуть MLflow, для чего в терминале сделать текущей папку проекта и выполнить команду: sh run_mlflow_server.sh
- Выполнить код в ноутбуке ./mlflow_server/notebook_step_1.ipynb

Результаты в MLflow:
- Имя эксперимента: 'mle-project-sprint-2'
- Имя запуска: 'step_1'
- ID запуска: '64fa92a4b2f848018acec0bfa7435f1f'
- Имя модели: 'flats_price_model_sprint_2_step_1' (сохранена в папке 'models')

#### Этап 2: Проведение EDA 
Были загружены и очищены исходные данные из проекта 1-го спринта, выявлены и проанализированы различные зависимости и особенности, построены графики и таблицы.
Результаты были залогированы в MLflow, включая файлы notebook_eda.ipynb с кодом и conclusions_eda.md с выводами.

Шаги:
- Выполнить код в ноутбуке ./mlflow_improvement/notebook_eda.ipynb со всеми шагами EDA
- Выполнить код в ноутбуке ./mlflow_improvement/notebook_steps_2_5.ipynb в разделе 2-го этапа для логирования результатов EDA (см. содержание со ссылками в начале ноутбука)

Результаты в MLflow:
- Имя эксперимента: 'mle-project-sprint-2'
- Имя запуска: 'step_2'
- ID запуска: ''
- Ноутбук и md-файл (сохранены в папке 'artifacts')

#### Этап 3: Генерация признаков и обучение модели
Были сгенерированы новые числовые признаки с помощью PolynomialFeatures, KBinsDiscretizer и AutoFeatRegressor (трансформации автогенератора: 'exp', 'log', 'abs', 'sqrt', '^2', '^3', '1/').
По сравнению с базовой моделью из 1-го этапа средняя ошибка MAPE на кросс-валидации уменьшилась с до . При этом увеличилось время обучения. 

Шаги:
- Выполнить код в ноутбуке ./mlflow_improvement/notebook_steps_2_5.ipynb в разделе 3-го этапа (см. содержание со ссылками в начале ноутбука).

Результаты в MLflow:
- Имя эксперимента: 'mle-project-sprint-2'
- Имя запуска: 'step_3'
- ID запуска: ''
- Имя модели: 'flats_price_model_sprint_2_step_3' (сохранена в папке 'models')
- Имя автогенератора признаков: 'AutoFeatRegressor' (сохранен в папке 'models')

#### Этап 4: Отбор признаков и обучение новой версии модели
С помощью методов Sequential Backward Selection и Sequential Forward Selection были отобраны признаки в обогащенных данных, полученных на предыдущем этапе.
Новая модель была обучена на объединении этих признаков. Средняя ошибка MAPE на кросс-валидации уменьшилась с до. Время обучения

Шаги:
- Выполнить код в ноутбуке ./mlflow_improvement/notebook_steps_2_5.ipynb в разделе 4-го этапа (см. содержание со ссылками в начале ноутбука).

Результаты в MLflow:
- Имя эксперимента: 'mle-project-sprint-2'
- Имя запуска: 'step_4'
- ID запуска: ''
- Имя модели: 'flats_price_model_sprint_2_step_4'
- Графики и таблицы (сохранены в папке 'fs_assets')

#### Этап 5: Подбор гиперпараметров и обучение новой версии модели
Были подобраны гиперпараметры на ранее обогащенных и отобранных признаках с помощью 2-х методов: случайного поиска и байесовской оптимизации. Наилучшие параметры были
получены с помощью []. После этого была обучена новая модель с лучшими параметрами и залогирована в MLflow.

Шаги:
- Выполнить код в ноутбуке ./mlflow_improvement/notebook_steps_2_5.ipynb в разделе 5-го этапа (см. содержание со ссылками в начале ноутбука).

Результаты в MLflow:
- Имя эксперимента: 'mle-project-sprint-2'
- Имя запуска: 'step_5'
- ID запуска: ''
- Имя модели: 'flats_price_model_sprint_2_step_5' (сохранена в папке 'models')
